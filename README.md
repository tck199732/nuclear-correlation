<a href="https://www.cplusplus.com/"><img src="https://img.shields.io/badge/C++-v17-005697.svg?style=flat&logo=c%2B%2B" alt="C++"></a>
<a href="https://root.cern/"><img src="https://img.shields.io/badge/ROOT-6.28.04-blue.svg?style=flat&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo5MEREM0ZCMTE3QTVFMzExODVDNDhENDcyNTVBNzdGNSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo0MTY3Q0YzNEE1MUYxMUUzQjJFNDk3MEU0NTA2N0U0MiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0MTY3Q0YzM0E1MUYxMUUzQjJFNDk3MEU0NTA2N0U0MiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IFdpbmRvd3MiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5MEREM0ZCMTE3QTVFMzExODVDNDhENDcyNTVBNzdGNSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5MEREM0ZCMTE3QTVFMzExODVDNDhENDcyNTVBNzdGNSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PuK5HSIAAAG3SURBVHjahJM5SwNREMdn3yabGFAUj8JCjSgGBbGwEdLaimIh1kIag/gFrLQSxE/gF1AbsQo2GmyUoI0nYqLGI+TSnJvNbt5zXrIJ6+Zw4Lfszpv57wwzT2CMgcmcyAoyi4zpvkfkBNlDQn+iuYABD5JhzS2jx9RyBL0CETlAFszlPCkaFGilShsR8pIASlKjIX9OmVnvbS9a9LjtRsncll7ikNBo+b3bQhz9VtEhgtA17ZD20TXPyxhBlEb1RtUSG7j5YNf5+mONMo3nElTxIlKjv98WVBAFAJfNWneGft62lwu4oYndocCgZAE7EZqFuAl2N2T08H5jes8PKNDo7wYbINkS7ah++dIFmH2OwmYkVavAZbe0EgAS0aiaKVFYe/8GTzgJw1jyUUqG06wCwaIG4/aWFbyR45TsnwvFoVMkcDbaB4fOHphqk8CLgiUG/7VwDsuh+GQcx2W0y5xSHt/E/VeLpayMsbyOvrQcMJ+uvCbYYjDWSmCnvMX8sRtNS1d5JWw8fS6obOPzp1nyESLWBKrgRFZVymTjJv53mcy3keNEtpALTE8rlMooGtB9TnP8rwADAN7Z882fu9StAAAAAElFTkSuQmCC" alt="ROOT"></a>
![Static Badge](https://img.shields.io/badge/cmake-3.14%2B-blue?logo=cmake)
<a href="https://docs.conda.io/projects/conda/en/stable/user-guide/index.html"><img src="https://img.shields.io/badge/conda-4.14.0-green.svg?style=flat&logo=anaconda"></a>
<a href="https://gitmoji.dev/"><img src="https://img.shields.io/badge/gitmoji-%20üòú%20üòç-FFDD67.svg?style=flat-square" alt="Gitmoji"></a>
<a href="https://github.com/doctest/doctest"><img src="https://img.shields.io/badge/doctest-2.4.11-green.svg?logo=data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPCEtLSBDcmVhdG9yOiBDb3JlbERSQVcgWDcgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWw6c3BhY2U9InByZXNlcnZlIiB3aWR0aD0iMjAuMjYyMW1tIiBoZWlnaHQ9IjI2LjQwNzNtbSIgdmVyc2lvbj0iMS4xIiBzdHlsZT0ic2hhcGUtcmVuZGVyaW5nOmdlb21ldHJpY1ByZWNpc2lvbjsgdGV4dC1yZW5kZXJpbmc6Z2VvbWV0cmljUHJlY2lzaW9uOyBpbWFnZS1yZW5kZXJpbmc6b3B0aW1pemVRdWFsaXR5OyBmaWxsLXJ1bGU6ZXZlbm9kZDsgY2xpcC1ydWxlOmV2ZW5vZGQiCnZpZXdCb3g9IjAgMCAzNzMgNDg2IgogeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogPGRlZnM+CiAgPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KICAgPCFbQ0RBVEFbCiAgICAuZmlsMCB7ZmlsbDojRkVGRUZFfQogICAgLmZpbDQge2ZpbGw6IzM5MzU2Q30KICAgIC5maWwxIHtmaWxsOiMzOTM1NkN9CiAgICAuZmlsMyB7ZmlsbDojNUVFMDQ1fQogICAgLmZpbDIge2ZpbGw6IzVFRTA0NX0KICAgXV0+CiAgPC9zdHlsZT4KIDwvZGVmcz4KIDxnIGlkPSJDYXBhX3gwMDIwXzEiPgogIDxtZXRhZGF0YSBpZD0iQ29yZWxDb3JwSURfMENvcmVsLUxheWVyIi8+CiAgPHBhdGggY2xhc3M9ImZpbDAiIGQ9Ik0yODAgODljMjcsLTIgNTMsMSA3OSw1IDIxLDMgMTcsMzUgLTcsMzAgLTMzLC02IC02NywtNyAtOTksMyAtMzIsMTAgLTQ0LDM2IC00Myw2OCAyLDI4IC00LDUzIC0xOCw3NyAtMTEsMTkgLTI2LDM1IC00MSw1MCAtNDIsMzkgLTQ2LDkwIC0zNywxNDMgNCwyMyAtMjUsMjggLTMyLDkgLTQ3LC0xMzEgLTM1LC0yNjYgNDksLTM4MCAxNCwtMjAgMzMsLTM0IDU3LC0zOCAzNCwtNiA2NywxMSA5MiwzM3oiLz4KICA8cGF0aCBjbGFzcz0iZmlsMSIgZD0iTTI3NiAxMDBjMjcsLTIgNTQsMCA4MSw0IDgsMiA3LDExIC0zLDkgLTM0LC02IC03MCwtNyAtMTA0LDQgLTM2LDExIC01Miw0MSAtNTAsNzkgMiw1MiAtMjMsODcgLTU3LDExOCAtNDQsNDEgLTQ5LDk1IC0zOSwxNTMgMSwxMCAtOSwxMCAtMTIsMyAtNDQsLTEyMSAtMzgsLTI1NCA0NywtMzcwIDM2LC00OSA5MiwtNDMgMTM3LDB6Ii8+CiAgPHBhdGggY2xhc3M9ImZpbDAiIGQ9Ik0yMDggMjYyYy0xNiw3NCAtMTA2LDEwMCAtMTcwLDExNSAtMjEsNSAtMzAsLTI0IC0xMCwtMzEgMjUsLTggNjEsLTE3IDc5LC0zNiA3LC03IDExLC0xNSAxNCwtMjQgNywtMjQgLTcsLTQzIC0yNywtNTcgLTc3LC01MiAtMTA1LC0xMjQgLTkwLC0yMTUgMywtMTggMjcsLTE5IDMzLC0yIDE0LDQyIDUwLDYzIDg4LDgwIDc0LDMzIDEwMCw5MSA4MywxNzB6Ii8+CiAgPHBhdGggY2xhc3M9ImZpbDIiIGQ9Ik0xOTggMjU5Yy0xNCw2NCAtODQsOTAgLTE2MywxMDggLTcsMiAtMTIsLTggLTQsLTExIDQ0LC0xNCA4NywtMjUgOTksLTY3IDgsLTI4IC01LC01MSAtMzAsLTY4IC03OSwtNTQgLTk5LC0xMjYgLTg2LC0yMDUgMSwtNyAxMCwtOCAxMywwIDE2LDQ1IDUzLDY3IDk0LDg1IDY4LDMwIDk0LDgzIDc3LDE1OHoiLz4KICA8cGF0aCBjbGFzcz0iZmlsMyIgZD0iTTE2NyAzNjJjMTgsLTMgMjgsLTEyIDMwLC0zMCAxLC0xOCAzMSwtMTcgMzEsMCAwLDIyIDEzLDI5IDMwLDMwIDE5LDEgMTgsMzAgMCwzMSAtMTksMSAtMjgsMTIgLTMwLDMwIC0yLDE5IC0zMSwxOSAtMzEsMCAwLC0xOSAtMTAsLTMxIC0zMCwtMzAgLTE2LDEgLTE4LC0yOCAwLC0zMXoiLz4KICA8cGF0aCBjbGFzcz0iZmlsNCIgZD0iTTI1NyAzMDdjMTgsLTMgMjgsLTEzIDMwLC0zMCAxLC0xOCAzMCwtMTggMzEsMCAwLDIyIDEyLDI5IDI5LDMwIDIwLDAgMTksMzAgMCwzMSAtMTksMSAtMjgsMTIgLTI5LDMwIC0yLDE5IC0zMSwxOSAtMzEsMCAwLC0xOSAtMTAsLTMxIC0zMCwtMzAgLTE2LDEgLTE4LC0yOSAwLC0zMXoiLz4KIDwvZz4KPC9zdmc+Cg==" alt="doctest"></a>

<b>
<table>
    <tr>
        <td>
            main branch
        </td>
        <td>
            <a href="https://github.com/tck199732/nuclear-correlation/actions?query=branch%3Amain"><img src="https://github.com/tck199732/nuclear-correlation/workflows/install/badge.svg"></a>
            <a href="https://github.com/tck199732/nuclear-correlation/actions?query=branch%3Amain"><img src="https://github.com/tck199732/nuclear-correlation/workflows/standalone/badge.svg"></a>
        </td>
        <td>
            <a href="https://codecov.io/gh/tck199732/nuclear-correlation" > <img src="https://codecov.io/gh/tck199732/nuclear-correlation/graph/badge.svg?token=4E6LNEDNY7"/> </a>
        </td>
    </tr>
    <tr>
    </tr>
</table>
</b>

# nuclear-correlation
Developed with [**`ROOT`**](root.cern) with `C++17`, `nuclear-correlation` provides a simple framework to calculate **two-particle correlation function** for both experimental data and simulated data. The repository is based on the `StHbt` developed years ago at CERN. 

### Why another repository for StHbt? 
- ‚ö°Ô∏èConsidered as an update version, developed with modern `C++` and `cmake` for better readability and tractability.
- üî• The legacy code was written years ago using `cpp11` and most code are designed for high-energy community in which many features are not required in low-energy nuclear physics. Some old mathematical libraries are also obsolete .
- üë∑Probably the "most important" reason, for me to learn the process of software development, following the [`ModernCppStarter`](https://github.com/TheLartians/ModernCppStarter).

### Change Note
-----------------
- üî•`ROOT` dictionary are not generated. Unless `ROOT 6.29+` is used, `rootcling` conflicts with the use of `std::filesystem`, see [here](https://root-forum.cern.ch/t/rootcling-with-std-filesystem/55388).
- ‚ú®Instead of defining mountains of quantities in `track`, `event` classes, uses `std::any` to handle everything. 
- ‚ú®added a singleton class [`ame`](util/ame/ame.hpp) for mass assignment to particles.
- use [`doctest`](https://github.com/doctest/doctest) to test source code.
- use github action for CI-CD
- üé® use clang-format to format all source code
- use [`codecov`](https://app.codecov.io/gh/tck199732/nuclear-correlation) to report coverage of test code.

## **Table of Content**
 - [Requirements & Installation](#0-requirements--installation)
 - [Starter](#1-starter)
 - [Directory Structure](#2-directory-structure)
 - [Usage](#3-usage)
 - [Further-Reading](#4-Further-Reading)

### 0. Requirements & Installation
--------------------
This repository is developed in a linux OS with ubuntu distribution. The only dependencies are 
- `cmake` version `3.14` or above. To install, simply run `apt-get install cmake`.
- `ROOT6`, required support of C++17 standard (see the [docker](https://hub.docker.com/r/rootproject/root) page). For installation, follow the instruction in the [official page](https://root.cern/install/#download-a-pre-compiled-binary-distribution). 

Finally, clone the repository
```{bash}
git clone https://github.com/tck199732/nuclear-correlation.git
```

Alternatively, if you prefer a contained environment, `conda` manages the dependencies and makes the installation easy. If you don't already have `conda`, 
download [here](https://docs.conda.io/projects/miniconda/en/latest/). 
```{bash}
git clone https://github.com/tck199732/nuclear-correlation.git
source ${miniconda3-prefix}/bin/activate
conda env create -f environment.yml --prefix ./env
```

### 1. Starter
----------------
First, check your installation of `ROOT6` and `cmake`. If your installatoin of `ROOT` is local, activate the startup script 
```
source ${root-prefix}/bin/thisroot.sh
```
where `${root-prefix}` refers to the path of installation in your system. If you are using a `conda`,  activate the environment by
```
conda activate ./env
```
You can check the version of the installation by 
``` {bash}
root-config --version
cmake --version
```
The output should be similar to the following
```
6.28/04
cmake version 3.26.4

CMake suite maintained and supported by Kitware (kitware.com/cmake).
```

To check the installation of the repository, we compile the source code and a program which reads sample data and construct correlation function. 
```{bash}
# creating a build
cmake -S standalone -B build 
cmake --build ./build -j4
# run the program
cd ./build
./main.exe
```

The expected output should be ...

### 2. Directory Structure
- [**`assets/`**](assets/) : contains useful data such as ame amss table and some sample data for testing purpose.
- [**`dev`**](dev/) : base class and backbone codes for correlation analysis using event-mixing method. User shall not modify in most scenario.
- [**`util`**](util/) : utility classes containing useful classes. 
- [**`custom`**](custom/) : all user-defined codes for customizing event reader, kinematic cuts and specific forms of correlation functions.
- [**`standalone`**](standalone/) : contain main scripts to run the program.
- [**`tests`**](tests/) : contains unit tests for the source codes resided in the above directories. (currently only `util` is tested.)
- [**`all`**](all/) : contains `CMakeLists.txt` to compile everything, useful to developers for CI-CD.

### 3. Usage

### 4. Further-Reading
 - [`Two-Proton CF paper`](https://link.aps.org/accepted/10.1103/PhysRevC.85.014606) : uses data from experiment E03045, two-proton CF exhibits dependence on momentum. 
 - [`Zbigniew's phd thesis`](https://inspirehep.net/files/455e02c0dc66388a4e86f2874ecc8023) : Check out chapter 5 for details in spherical-harmonincs decompoistion of Correlation Function.
 - [`Spherical-Harmoncis Components Paper`](https://journals.aps.org/prc/abstract/10.1103/PhysRevC.80.064911) : Directly sample 1D numerator and denominator weighted with $Y_l^m$, which alse used to extract components of CF expanded with $Y_l^m$.
 - [`Theory on the spherical moments`](https://journals.aps.org/prc/abstract/10.1103/PhysRevC.81.064906)



